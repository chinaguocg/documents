# Nginx 基础

关于 HTTP web 服务：Nginx、Apache、Tomcat、IIS 



官网地址 [nginx](https://nginx.org/)

学习前准备工作：

- 调试好三台机器（node1、node2、node3）

- 调试好网络：修改hosts文件

  ```shell
  [root@bogon ~]# vim /etc/hosts
  [root@bogon ~]# cat /etc/hosts
  127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
  ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
  
  192.168.230.129 node1
  192.168.230.130 node2
  192.168.230.131 node3
  
  [root@bogon ~]# 
  
  ```

- 验证是否安装apache并卸载

  ```shell
  [root@bogon ~]# yum list installed | grep httpd
  httpd.x86_64                          2.4.6-99.el7.centos.1            @updates 
  httpd-tools.x86_64                    2.4.6-99.el7.centos.1            @updates 
  [root@bogon ~]# sudo systemctl stop httpd
  [root@bogon ~]# sudo systemctl disable httpd
  Removed symlink /etc/systemd/system/multi-user.target.wants/httpd.service.
  [root@bogon ~]# sudo yum remove httpd
  Loaded plugins: fastestmirror
  Resolving Dependencies
  --> Running transaction check
  ---> Package httpd.x86_64 0:2.4.6-99.el7.centos.1 will be erased
  --> Finished Dependency Resolution
  
  Dependencies Resolved
  
  =================================================================================================================================================================================================================
   Package                                      Arch                                          Version                                                        Repository                                       Size
  =================================================================================================================================================================================================================
  Removing:
   httpd                                        x86_64                                        2.4.6-99.el7.centos.1                                          @updates                                        9.4 M
  
  Transaction Summary
  =================================================================================================================================================================================================================
  Remove  1 Package
  
  Installed size: 9.4 M
  Is this ok [y/N]: y
  Downloading packages:
  Running transaction check
  Running transaction test
  Transaction test succeeded
  Running transaction
    Erasing    : httpd-2.4.6-99.el7.centos.1.x86_64                                                                                                                                                            1/1 
    Verifying  : httpd-2.4.6-99.el7.centos.1.x86_64                                                                                                                                                            1/1 
  
  Removed:
    httpd.x86_64 0:2.4.6-99.el7.centos.1                                                                                                                                                                           
  
  Complete!
  [root@bogon ~]# yum list installed | grep httpd
  httpd-tools.x86_64                    2.4.6-99.el7.centos.1            @updates 
  [root@bogon ~]# sudo systemctl stop httpd-tools
  Failed to stop httpd-tools.service: Unit httpd-tools.service not loaded.
  [root@bogon ~]# sudo systemctl disable httpd-tools
  Failed to execute operation: No such file or directory
  [root@bogon ~]# sudo yum remove httpd-tools
  Loaded plugins: fastestmirror
  Resolving Dependencies
  --> Running transaction check
  ---> Package httpd-tools.x86_64 0:2.4.6-99.el7.centos.1 will be erased
  --> Finished Dependency Resolution
  
  Dependencies Resolved
  
  =================================================================================================================================================================================================================
   Package                                           Arch                                         Version                                                     Repository                                      Size
  =================================================================================================================================================================================================================
  Removing:
   httpd-tools                                       x86_64                                       2.4.6-99.el7.centos.1                                       @updates                                       168 k
  
  Transaction Summary
  =================================================================================================================================================================================================================
  Remove  1 Package
  
  Installed size: 168 k
  Is this ok [y/N]: y
  Downloading packages:
  Running transaction check
  Running transaction test
  Transaction test succeeded
  Running transaction
    Erasing    : httpd-tools-2.4.6-99.el7.centos.1.x86_64                                                                                                                                                      1/1 
    Verifying  : httpd-tools-2.4.6-99.el7.centos.1.x86_64                                                                                                                                                      1/1 
  
  Removed:
    httpd-tools.x86_64 0:2.4.6-99.el7.centos.1                                                                                                                                                                     
  
  Complete!
  [root@bogon ~]# yum list installed | grep httpd
  [root@bogon ~]# 
  ```

- 安装nginx并实现页面访问

  ```shell
  Xshell for Xmanager Enterprise 5 (Build 0547)
  Copyright (c) 2002-2015 NetSarang Computer, Inc. All rights reserved.
  
  Type `help' to learn how to use Xshell prompt.
  [c:\~]$ 
  
  Connecting to 192.168.230.130:22...
  Connection established.
  To escape to local shell, press 'Ctrl+Alt+]'.
  
  WARNING! The remote SSH server rejected X11 forwarding request.
  Last login: Sun Nov  2 04:21:03 2025 from 192.168.230.1
  [root@node2 ~]# yum install nginx -y
  Loaded plugins: fastestmirror
  base                                                                                                                                                                                      | 3.6 kB  00:00:00     
  epel                                                                                                                                                                                      | 4.3 kB  00:00:00     
  extras                                                                                                                                                                                    | 2.9 kB  00:00:00     
  updates                                                                                                                                                                                   | 2.9 kB  00:00:00     
  Loading mirror speeds from cached hostfile
  Resolving Dependencies
  --> Running transaction check
  ---> Package nginx.x86_64 1:1.20.1-10.el7 will be installed
  --> Processing Dependency: nginx-filesystem = 1:1.20.1-10.el7 for package: 1:nginx-1.20.1-10.el7.x86_64
  --> Processing Dependency: libcrypto.so.1.1(OPENSSL_1_1_0)(64bit) for package: 1:nginx-1.20.1-10.el7.x86_64
  --> Processing Dependency: libssl.so.1.1(OPENSSL_1_1_0)(64bit) for package: 1:nginx-1.20.1-10.el7.x86_64
  --> Processing Dependency: libssl.so.1.1(OPENSSL_1_1_1)(64bit) for package: 1:nginx-1.20.1-10.el7.x86_64
  --> Processing Dependency: nginx-filesystem for package: 1:nginx-1.20.1-10.el7.x86_64
  --> Processing Dependency: redhat-indexhtml for package: 1:nginx-1.20.1-10.el7.x86_64
  --> Processing Dependency: libcrypto.so.1.1()(64bit) for package: 1:nginx-1.20.1-10.el7.x86_64
  --> Processing Dependency: libprofiler.so.0()(64bit) for package: 1:nginx-1.20.1-10.el7.x86_64
  --> Processing Dependency: libssl.so.1.1()(64bit) for package: 1:nginx-1.20.1-10.el7.x86_64
  --> Running transaction check
  ---> Package centos-indexhtml.noarch 0:7-9.el7.centos will be installed
  ---> Package gperftools-libs.x86_64 0:2.6.1-1.el7 will be installed
  ---> Package nginx-filesystem.noarch 1:1.20.1-10.el7 will be installed
  ---> Package openssl11-libs.x86_64 1:1.1.1k-7.el7 will be installed
  --> Finished Dependency Resolution
  
  Dependencies Resolved
  
  =================================================================================================================================================================================================================
   Package                                                 Arch                                          Version                                                 Repository                                   Size
  =================================================================================================================================================================================================================
  Installing:
   nginx                                                   x86_64                                        1:1.20.1-10.el7                                         epel                                        588 k
  Installing for dependencies:
   centos-indexhtml                                        noarch                                        7-9.el7.centos                                          base                                         92 k
   gperftools-libs                                         x86_64                                        2.6.1-1.el7                                             base                                        272 k
   nginx-filesystem                                        noarch                                        1:1.20.1-10.el7                                         epel                                         24 k
   openssl11-libs                                          x86_64                                        1:1.1.1k-7.el7                                          epel                                        1.5 M
  
  Transaction Summary
  =================================================================================================================================================================================================================
  Install  1 Package (+4 Dependent packages)
  
  Total download size: 2.4 M
  Installed size: 6.7 M
  Downloading packages:
  (1/5): centos-indexhtml-7-9.el7.centos.noarch.rpm                                                                                                                                         |  92 kB  00:00:00     
  warning: /var/cache/yum/x86_64/7/epel/packages/nginx-filesystem-1.20.1-10.el7.noarch.rpm: Header V4 RSA/SHA256 Signature, key ID 352c64e5: NOKEY
  Public key for nginx-filesystem-1.20.1-10.el7.noarch.rpm is not installed
  (2/5): nginx-filesystem-1.20.1-10.el7.noarch.rpm                                                                                                                                          |  24 kB  00:00:00     
  (3/5): gperftools-libs-2.6.1-1.el7.x86_64.rpm                                                                                                                                             | 272 kB  00:00:00     
  (4/5): nginx-1.20.1-10.el7.x86_64.rpm                                                                                                                                                     | 588 kB  00:00:00     
  (5/5): openssl11-libs-1.1.1k-7.el7.x86_64.rpm                                                                                                                                             | 1.5 MB  00:00:00     
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  Total                                                                                                                                                                            1.7 MB/s | 2.4 MB  00:00:01     
  Retrieving key from http://mirrors.cloud.tencent.com/epel/RPM-GPG-KEY-EPEL-7
  Importing GPG key 0x352C64E5:
   Userid     : "Fedora EPEL (7) <epel@fedoraproject.org>"
   Fingerprint: 91e9 7d7c 4a5e 96f1 7f3e 888f 6a2f aea2 352c 64e5
   From       : http://mirrors.cloud.tencent.com/epel/RPM-GPG-KEY-EPEL-7
  Running transaction check
  Running transaction test
  Transaction test succeeded
  Running transaction
    Installing : 1:openssl11-libs-1.1.1k-7.el7.x86_64                                                                                                                                                          1/5 
    Installing : 1:nginx-filesystem-1.20.1-10.el7.noarch                                                                                                                                                       2/5 
    Installing : centos-indexhtml-7-9.el7.centos.noarch                                                                                                                                                        3/5 
    Installing : gperftools-libs-2.6.1-1.el7.x86_64                                                                                                                                                            4/5 
    Installing : 1:nginx-1.20.1-10.el7.x86_64                                                                                                                                                                  5/5 
    Verifying  : gperftools-libs-2.6.1-1.el7.x86_64                                                                                                                                                            1/5 
    Verifying  : centos-indexhtml-7-9.el7.centos.noarch                                                                                                                                                        2/5 
    Verifying  : 1:nginx-filesystem-1.20.1-10.el7.noarch                                                                                                                                                       3/5 
    Verifying  : 1:nginx-1.20.1-10.el7.x86_64                                                                                                                                                                  4/5 
    Verifying  : 1:openssl11-libs-1.1.1k-7.el7.x86_64                                                                                                                                                          5/5 
  
  Installed:
    nginx.x86_64 1:1.20.1-10.el7                                                                                                                                                                                   
  
  Dependency Installed:
    centos-indexhtml.noarch 0:7-9.el7.centos              gperftools-libs.x86_64 0:2.6.1-1.el7              nginx-filesystem.noarch 1:1.20.1-10.el7              openssl11-libs.x86_64 1:1.1.1k-7.el7             
  
  Complete!
  [root@node2 ~]# systemctl stop httpd
  Failed to stop httpd.service: Unit httpd.service not loaded.
  [root@node2 ~]# systemctl stop firewalld
  [root@node2 ~]# setenforce 0
  [root@node2 ~]# cd /etc/nginx
  [root@node2 nginx]# ll
  total 68
  drwxr-xr-x. 2 root root    6 Nov 10  2022 conf.d
  drwxr-xr-x. 2 root root    6 Nov 10  2022 default.d
  -rw-r--r--. 1 root root 1077 Nov 10  2022 fastcgi.conf
  -rw-r--r--. 1 root root 1077 Nov 10  2022 fastcgi.conf.default
  -rw-r--r--. 1 root root 1007 Nov 10  2022 fastcgi_params
  -rw-r--r--. 1 root root 1007 Nov 10  2022 fastcgi_params.default
  -rw-r--r--. 1 root root 2837 Nov 10  2022 koi-utf
  -rw-r--r--. 1 root root 2223 Nov 10  2022 koi-win
  -rw-r--r--. 1 root root 5231 Nov 10  2022 mime.types
  -rw-r--r--. 1 root root 5231 Nov 10  2022 mime.types.default
  -rw-r--r--. 1 root root 2336 Nov 10  2022 nginx.conf
  -rw-r--r--. 1 root root 2656 Nov 10  2022 nginx.conf.default
  -rw-r--r--. 1 root root  636 Nov 10  2022 scgi_params
  -rw-r--r--. 1 root root  636 Nov 10  2022 scgi_params.default
  -rw-r--r--. 1 root root  664 Nov 10  2022 uwsgi_params
  -rw-r--r--. 1 root root  664 Nov 10  2022 uwsgi_params.default
  -rw-r--r--. 1 root root 3610 Nov 10  2022 win-utf
  [root@node2 nginx]# mkdir -p /data/images/
  [root@node2 nginx]# cd /data/images
  [root@node2 images]# ll
  total 0
  [root@node2 images]# rz
  -bash: rz: command not found
  [root@node2 images]# ll
  total 132
  -rw-r--r--. 1 root root 133327 Nov  2 21:10 1.png
  [root@node2 images]# vim index.html
  [root@node2 images]# cat index.html
  <img src="/data/images/1.png" />
  [root@node2 images]# cd /etc/nginx/conf.d/
  [root@node2 conf.d]# vim qf.conf
  [root@node2 conf.d]# systemctl restart nginx
  [root@node2 conf.d]# systemctl enable nginx
  Created symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.
  [root@node2 conf.d]# vim index.html
  [root@node2 conf.d]# cd /data/images
  [root@node2 images]# ll
  total 136
  -rw-r--r--. 1 root root 133327 Nov  2 21:10 1.png
  -rw-r--r--. 1 root root     33 Nov  2 21:12 index.html
  [root@node2 images]# vim index.html
  [root@node2 images]# cat index.html
  <img src="1.png" />
  [root@node2 images]# 
  
  ```

  打开浏览器访问该页面

  案例2：添加news

  ```shell
  [root@node2 conf.d]# cd /data/
  [root@node2 data]# ll
  total 0
  drwxr-xr-x. 2 root root 37 Nov  2 21:21 images
  [root@node2 data]# mkdir news
  [root@node2 data]# ll
  total 0
  drwxr-xr-x. 2 root root 37 Nov  2 21:21 images
  drwxr-xr-x. 2 root root  6 Nov  2 22:07 news
  [root@node2 data]# cd news
  [root@node2 data]# vim index.html
  [root@node2 news]# cd /etc/nginx/conf.d/
  [root@node2 conf.d]# ll
  total 4
  -rw-r--r--. 1 root root 159 Nov  2 22:06 qf.conf
  [root@node2 conf.d]# vim qf.conf
  [root@node2 conf.d]# cat qf.conf
  server {
  	listen 80;
  	server_name www.qf.com;
  	location / {
  		root /data/images/;
  	}
          location /news/ {
                  root /data/;
          }
  
  
  }
  [root@node2 conf.d]# systemctl restart nginx
  
  ```

  浏览器访问 www.qf.com/news/index.html 或者 IP/news

  测试路径配置问题

  ```shell
  [root@node2 ~]# cd /etc/nginx/conf.d/
  [root@node2 conf.d]# vim qf.conf
  [root@node2 sport]# cat /etc/nginx/conf.d/qf.conf
  server {
  	listen 80;
  	server_name www.qf.com;
  	location / {
  		root /data/images/;
  	}
          location /news/ {
                  root /data/;
          }
  	location /sport/ {
                  root /data/sport/;
          }
  
  
  }
  [root@node2 conf.d]# cd /data
  [root@node2 data]# ll
  total 0
  drwxr-xr-x. 2 root root 37 Nov  2 21:21 images
  drwxr-xr-x. 2 root root 24 Nov  2 22:20 news
  [root@node2 data]# mkdir sport
  [root@node2 data]# cd sport
  [root@node2 sport]# ll
  total 0
  [root@node2 sport]# mkdir sport
  [root@node2 sport]# ll
  total 0
  drwxr-xr-x. 2 root root 6 Nov  2 23:53 sport
  [root@node2 sport]# cd sport
  [root@node2 sport]# ll
  total 0
  [root@node2 sport]# vim index.html
  [root@node2 sport]# cat index.html
  data/sport/sport/index.html
  root
  location
  [root@node2 sport]# 
  [root@node2 sport]# systemctl restart nginx
  [root@node2 sport]# 
  
  ```

  案例：代理服务

  ```shell
  Connecting to 192.168.230.129:22...
  Connection established.
  To escape to local shell, press 'Ctrl+Alt+]'.
  
  WARNING! The remote SSH server rejected X11 forwarding request.
  Last login: Sun Nov  2 22:42:09 2025 from 192.168.230.1
  
  [root@node1 ~]# cd /etc/nginx
  [root@node1 nginx]# ll
  total 68
  drwxr-xr-x. 2 root root    6 Nov 10  2022 conf.d
  drwxr-xr-x. 2 root root    6 Nov 10  2022 default.d
  -rw-r--r--. 1 root root 1077 Nov 10  2022 fastcgi.conf
  -rw-r--r--. 1 root root 1077 Nov 10  2022 fastcgi.conf.default
  -rw-r--r--. 1 root root 1007 Nov 10  2022 fastcgi_params
  -rw-r--r--. 1 root root 1007 Nov 10  2022 fastcgi_params.default
  -rw-r--r--. 1 root root 2837 Nov 10  2022 koi-utf
  -rw-r--r--. 1 root root 2223 Nov 10  2022 koi-win
  -rw-r--r--. 1 root root 5231 Nov 10  2022 mime.types
  -rw-r--r--. 1 root root 5231 Nov 10  2022 mime.types.default
  -rw-r--r--. 1 root root 2336 Nov 10  2022 nginx.conf
  -rw-r--r--. 1 root root 2656 Nov 10  2022 nginx.conf.default
  -rw-r--r--. 1 root root  636 Nov 10  2022 scgi_params
  -rw-r--r--. 1 root root  636 Nov 10  2022 scgi_params.default
  -rw-r--r--. 1 root root  664 Nov 10  2022 uwsgi_params
  -rw-r--r--. 1 root root  664 Nov 10  2022 uwsgi_params.default
  -rw-r--r--. 1 root root 3610 Nov 10  2022 win-utf
  [root@node1 nginx]# cd conf.d
  [root@node1 conf.d]# ll
  total 0
  [root@node1 conf.d]# vim proxy.conf
  [root@node1 conf.d]# systemctl restart nginx
  [root@node1 conf.d]# cat proxy.conf
  server {
  	location /news/ {
  
  		proxy_pass http://node2;
  	}
  
  
  
  }
  [root@node1 conf.d]# 
  
  ```

  浏览器访问代理服务器node1的地址 http://192.168.230.129/news/

  案例：一台机器配置两个服务站点

  ```shell
  Connecting to 192.168.230.129:22...
  Connection established.
  To escape to local shell, press 'Ctrl+Alt+]'.
  
  WARNING! The remote SSH server rejected X11 forwarding request.
  Last login: Sun Nov  2 22:42:09 2025 from 192.168.230.1
  [root@node1 ~]# cd /etc/nginx/conf.d
  [root@node1 conf.d]# ll
  total 4
  -rw-r--r--. 1 root root 64 Nov  3 01:25 proxy.conf
  [root@node1 conf.d]# vim more_site.conf
  [root@node1 conf.d]# cat more_site.conf
  server{
  	server_name www.beijing.com;
  	location / {
  		root /beijing/;
  	}
  }
  
  server{
          server_name www.shanghai.com;
          location / {
                  root /shanghai/;
          }
  }
  
  [root@node1 conf.d]# 
  [root@node1 conf.d]# cd /
  [root@node1 /]# mkdir beijing
  [root@node1 /]# mkdir shanghai
  [root@node1 /]# cd beijing
  [root@node1 beijing]# vim index.html
  [root@node1 beijing]# cd ..
  [root@node1 /]# cd shanghai
  [root@node1 shanghai]# ll
  total 0
  [root@node1 shanghai]# vim index.html
  [root@node1 shanghai]# cd ..
  [root@node1 /]# ll
  total 20
  drwxr-xr-x.   2 root root   24 Nov  3 02:02 beijing
  lrwxrwxrwx.   1 root root    7 Nov  2 03:33 bin -> usr/bin
  dr-xr-xr-x.   5 root root 4096 Nov  2 03:40 boot
  drwxr-xr-x.  20 root root 3240 Nov  2 22:38 dev
  drwxr-xr-x.  76 root root 8192 Nov  2 23:39 etc
  drwxr-xr-x.   3 root root   16 Nov  2 03:37 home
  lrwxrwxrwx.   1 root root    7 Nov  2 03:33 lib -> usr/lib
  lrwxrwxrwx.   1 root root    9 Nov  2 03:33 lib64 -> usr/lib64
  drwxr-xr-x.   2 root root    6 Nov  5  2016 media
  drwxr-xr-x.   2 root root    6 Nov  5  2016 mnt
  drwxr-xr-x.   2 root root    6 Nov  5  2016 opt
  dr-xr-xr-x. 165 root root    0 Nov  2 22:38 proc
  dr-xr-x---.   3 root root  163 Nov  3 02:03 root
  drwxr-xr-x.  24 root root  740 Nov  3 01:25 run
  lrwxrwxrwx.   1 root root    8 Nov  2 03:33 sbin -> usr/sbin
  drwxr-xr-x.   2 root root   24 Nov  3 02:03 shanghai
  drwxr-xr-x.   2 root root    6 Nov  5  2016 srv
  dr-xr-xr-x.  13 root root    0 Nov  2 22:38 sys
  drwxrwxrwt.  11 root root 4096 Nov  3 01:25 tmp
  drwxr-xr-x.  13 root root  155 Nov  2 03:33 usr
  drwxr-xr-x.  19 root root  267 Nov  2 03:39 var
  [root@node1 /]# systemctl restart nginx
  [root@node1 conf.d]# vim /etc/hosts
  [root@node1 conf.d]# cat  /etc/hosts
  127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
  ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
  
  
  192.168.230.129 node1 www.beijing.com www.shanghai.com
  192.168.230.130 node2
  192.168.230.131 node3
  [root@node1 conf.d]# 
  [root@node1 conf.d]# curl http://www.shanghai.com
  shanghaishanghai
  [root@node1 conf.d]# curl http://www.beijing.com
  beijing
  [root@node1 conf.d]# 
  
  ```

  
