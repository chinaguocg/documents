# Linux 进阶 - 初识SELinux

SELinux是美国国安局提出的标准项目，红帽官方采用了该标准。

采用后有了两层安全权限

[第 1 章 SELinux 入门](https://docs.redhat.com/zh-cn/documentation/red_hat_enterprise_linux/10/html/using_selinux/getting-started-with-selinux#introduction-to-selinux)

![selinux_01](/documents/img/ops/linux/high-level/selinux/01.png)
![selinux_02](/documents/img/ops/linux/high-level/selinux/02.png)
![selinux_03](/documents/img/ops/linux/high-level/selinux/03.png)
![selinux_04](/documents/img/ops/linux/high-level/selinux/04.png)
![selinux_05](/documents/img/ops/linux/high-level/selinux/05.png)
![selinux_06](/documents/img/ops/linux/high-level/selinux/06.png)
![selinux_07](/documents/img/ops/linux/high-level/selinux/07.png)
![selinux_08](/documents/img/ops/linux/high-level/selinux/08.png)
:tada:**修改完后必须重启系统**:tada:**修改完后必须重启系统**:tada:**修改完后必须重启系统**:tada:

:tada:**关于修改类型值**

- 1）chcon  -t  直接修改 
- 2）restorecon 
- 3）semanage  fcontext

案例： semanage  fcontext  -a   -t   httpd_sys_content_t '/defauts(/.*)?'

![selinux_09](/documents/img/ops/linux/high-level/selinux/09.jpg)
![selinux_10](/documents/img/ops/linux/high-level/selinux/10.jpg)
![selinux_11](/documents/img/ops/linux/high-level/selinux/11.png)

```bash
ARNING! The remote SSH server rejected X11 forwarding request.
Last login: Tue Nov  4 20:34:51 2025 from 192.168.230.1
[root@node1 ~]# setenforce 1
[root@node1 ~]# ll
total 4
-rw-------. 1 root root 1417 Nov  2 03:38 anaconda-ks.cfg
[root@node1 ~]# ls
anaconda-ks.cfg
[root@node1 ~]# cd /
[root@node1 /]# ll
total 20
drwxr-xr-x.   2 root root   24 Nov  3 02:02 beijing
lrwxrwxrwx.   1 root root    7 Nov  2 03:33 bin -> usr/bin
dr-xr-xr-x.   5 root root 4096 Nov  2 03:40 boot
drwxr-xr-x.   2 root root   24 Nov  3 21:08 data
drwxr-xr-x.  20 root root 3240 Nov  4 20:32 dev
drwxr-xr-x.  82 root root 8192 Nov  5 00:50 etc
drwxr-xr-x.   3 root root   16 Nov  2 03:37 home
lrwxrwxrwx.   1 root root    7 Nov  2 03:33 lib -> usr/lib
lrwxrwxrwx.   1 root root    9 Nov  2 03:33 lib64 -> usr/lib64
drwxr-xr-x.   2 root root    6 Nov  5  2016 media
drwxr-xr-x.   2 root root    6 Nov  5  2016 mnt
drwxr-xr-x.   3 root root   24 Nov  3 22:57 opt
dr-xr-xr-x. 168 root root    0 Nov  4 20:32 proc
drwxr-xr-x.   2 root root   24 Nov  4 20:45 qianfeng
drwxr-xr-x.   2 root root   64 Nov  4 22:16 qianfeng2
dr-xr-x---.   4 root root  178 Nov  4 22:16 root
drwxr-xr-x.  28 root root  840 Nov  5 00:50 run
lrwxrwxrwx.   1 root root    8 Nov  2 03:33 sbin -> usr/sbin
drwxr-xr-x.   2 root root   24 Nov  3 02:03 shanghai
drwxr-xr-x.   2 root root    6 Nov  5  2016 srv
dr-xr-xr-x.  13 root root    0 Nov  4 20:32 sys
drwxrwxrwt.  19 root root 4096 Nov  5 00:50 tmp
drwxr-xr-x.  13 root root  155 Nov  2 03:33 usr
drwxr-xr-x.  19 root root  267 Nov  2 03:39 var
[root@node1 /]# mkfir test_selinux
-bash: mkfir: command not found
[root@node1 /]# mkdir test_selinux
[root@node1 /]# ll
total 20
drwxr-xr-x.   2 root root   24 Nov  3 02:02 beijing
lrwxrwxrwx.   1 root root    7 Nov  2 03:33 bin -> usr/bin
dr-xr-xr-x.   5 root root 4096 Nov  2 03:40 boot
drwxr-xr-x.   2 root root   24 Nov  3 21:08 data
drwxr-xr-x.  20 root root 3240 Nov  4 20:32 dev
drwxr-xr-x.  82 root root 8192 Nov  5 00:50 etc
drwxr-xr-x.   3 root root   16 Nov  2 03:37 home
lrwxrwxrwx.   1 root root    7 Nov  2 03:33 lib -> usr/lib
lrwxrwxrwx.   1 root root    9 Nov  2 03:33 lib64 -> usr/lib64
drwxr-xr-x.   2 root root    6 Nov  5  2016 media
drwxr-xr-x.   2 root root    6 Nov  5  2016 mnt
drwxr-xr-x.   3 root root   24 Nov  3 22:57 opt
dr-xr-xr-x. 168 root root    0 Nov  4 20:32 proc
drwxr-xr-x.   2 root root   24 Nov  4 20:45 qianfeng
drwxr-xr-x.   2 root root   64 Nov  4 22:16 qianfeng2
dr-xr-x---.   4 root root  178 Nov  4 22:16 root
drwxr-xr-x.  28 root root  840 Nov  5 00:50 run
lrwxrwxrwx.   1 root root    8 Nov  2 03:33 sbin -> usr/sbin
drwxr-xr-x.   2 root root   24 Nov  3 02:03 shanghai
drwxr-xr-x.   2 root root    6 Nov  5  2016 srv
dr-xr-xr-x.  13 root root    0 Nov  4 20:32 sys
drwxr-xr-x.   2 root root    6 Nov  5 01:58 test_selinux
drwxrwxrwt.  19 root root 4096 Nov  5 00:50 tmp
drwxr-xr-x.  13 root root  155 Nov  2 03:33 usr
drwxr-xr-x.  19 root root  267 Nov  2 03:39 var
[root@node1 /]# cd test_selinux
[root@node1 test_selinux]# mkdir test
[root@node1 test_selinux]# ll
total 0
drwxr-xr-x. 2 root root 6 Nov  5 01:58 test
[root@node1 test_selinux]#  getenforce
Enforcing
[root@node1 test_selinux]# ls -lZd test
drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 test
[root@node1 test_selinux]# chcon -t httpd_sys_content_t test
[root@node1 test_selinux]# ls -lZd test
drwxr-xr-x. root root unconfined_u:object_r:httpd_sys_content_t:s0 test
[root@node1 test_selinux]# restorecon -v test
restorecon reset /test_selinux/test context unconfined_u:object_r:httpd_sys_content_t:s0->unconfined_u:object_r:default_t:s0
[root@node1 test_selinux]# ls -lZd test
drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 test
[root@node1 test_selinux]# semanage fcontext -a -t httpd_sys_content_t 'test(/.*)?'
[root@node1 test_selinux]# ls -lZd test
drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 test
[root@node1 test_selinux]# restorecon test
[root@node1 test_selinux]# ls -lZd test
drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 test
[root@node1 test_selinux]# restorecon -v test
[root@node1 test_selinux]# ls -lZd test
drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 test
[root@node1 test_selinux]# semanage fcontext -a -t httpd_sys_content_t './test(/.*)?'
[root@node1 test_selinux]# ls -lZd test
drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 test
[root@node1 test_selinux]# restorecon test
[root@node1 test_selinux]# ls -lZd test
drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 test
[root@node1 test_selinux]# restorecon ./test
[root@node1 test_selinux]# ls -lZd test
drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 test
[root@node1 test_selinux]# semanage fcontext -a -t httpd_sys_content_t '/test_selinux/test(/.*)?'
[root@node1 test_selinux]# ls -lZd test
drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 test
[root@node1 test_selinux]# restorecon test
[root@node1 test_selinux]# ls -lZd test
drwxr-xr-x. root root unconfined_u:object_r:httpd_sys_content_t:s0 test
[root@node1 test_selinux]# 

```

