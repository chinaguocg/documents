# Ansible 初识一：控制与被控

Ansible是一款开源的实现自动化运维的平台。



> 术语：
>
> playbook: 剧本
>
> inventory: 清单
>
> task： 任务
>
> modules： 模块
>
> Plugins :  插件
>
> agent:  代理



> ansible的特性：
>
> - 1） 它使用简单的yaml格式的语言，不需要特定的编码基础。
>
> - 2） 无代理--agentless。
>
> - 3） ansible 架构分为控制端和被管理端，ansible只能安装在控制节点上，控制节点的系统必须为linux，被管理节点无差别。
>
> - 4） 大部分模块被设计为幂等性，可以多次安全地去执行



工作原理：
ansible自带了很多模块（实现具体任务的小程序），模块通过连接插件（通常是ssh服务）发送到被管理节点上，去完成相应的task。

**被管理节点需要达成相应的 <u>特定状态</u>。（期望的状态），完成后，模块自动删除。**



**安装ansible:**
**在控制节点： yum  install ansible  -y**



**前期准备工作：**

- 1) 实现免密登录
  在控制节点：

```shell
ssh-keygen 
ssh-copy-id -i  /home/jess/.ssh/id_rsa.pub   Jess@node1        //为node1的jess用户免密
ssh-copy-id -i  /home/jess/.ssh/id_rsa.pub   jess@node2            //为node2的jess用户免密
```

- 2）sudo提权	 
  在控制节点：

```shell
vim   /etc/sudoers.d/jess
jess   ALL=	NOPASSWD:   ALL
scp   /etc/sudoers.d/jess     root@node1:/etc/sudoers.d/
scp   /etc/sudoers.d/jess     root@node1:/etc/sudoers.d/
```



**关于清单文件**

清单文件分为：静态和动态

默认的清单文件： /etc/ansible/hosts

<u>默认的一般不用，需要在项目目录下创建自定义的清单文件</u>

<u>mkdir  /home/xxx/yyy/     //创建项目目录</u>

```
x.example.com
192.168.72.130
```

[start:end] 
清单文件中的主机，可以被划分成不同的group。使用[   ]代表组名称。同时组可以被嵌套。
使用”children”关键字来构成嵌套组。[groupname:children]。
Tip: 一直存在两个特殊的组名：<u>all,  ungrouped</u>

验证：
ansible  组名|主机名   --list-hosts   [-i   清单文件名称] 

```
[jess@localhost project]$ ansible qf1 --list-hosts --inventory inventory
  hosts (1):
    192.168.72.130
```



完整代码示例如下

```shell
                             noarch                                  2.14-1.el7                                      base                                    104 k
 python2-cryptography                                  x86_64                                  1.7.2-2.el7                                     base                                    502 k
 python2-httplib2                                      noarch                                  0.18.1-3.el7                                    epel                                    125 k
 python2-jmespath                                      noarch                                  0.9.4-2.el7                                     epel                                     41 k
 python2-pyasn1                                        noarch                                  0.1.9-7.el7                                     base                                    100 k
 sshpass                                               x86_64                                  1.06-2.el7                                      extras                                   21 k

事务概要
=============================================================================================================================================================================================
安装  1 软件包 (+16 依赖软件包)

总下载量：21 M
安装大小：120 M
Downloading packages:
(1/17): libyaml-0.1.4-11.el7_0.x86_64.rpm                                                                                                                             |  55 kB  00:00:00     
(2/17): PyYAML-3.10-11.el7.x86_64.rpm                                                                                                                                 | 153 kB  00:00:00     
(3/17): python-cffi-1.6.0-5.el7.x86_64.rpm                                                                                                                            | 218 kB  00:00:00     
(4/17): python-enum34-1.0.4-1.el7.noarch.rpm                                                                                                                          |  52 kB  00:00:00     
(5/17): python-idna-2.4-1.el7.noarch.rpm                                                                                                                              |  94 kB  00:00:00     
(6/17): python-jinja2-2.7.2-4.el7.noarch.rpm                                                                                                                          | 519 kB  00:00:01     
(7/17): python-markupsafe-0.11-10.el7.x86_64.rpm                                                                                                                      |  25 kB  00:00:00     
(8/17): python-babel-0.9.6-8.el7.noarch.rpm                                                                                                                           | 1.4 MB  00:00:04     
(9/17): python-ply-3.4-11.el7.noarch.rpm                                                                                                                              | 123 kB  00:00:00     
(10/17): python-pycparser-2.14-1.el7.noarch.rpm                                                                                                                       | 104 kB  00:00:00     
(11/17): python-paramiko-2.1.1-9.el7.noarch.rpm                                                                                                                       | 269 kB  00:00:01     
warning: /var/cache/yum/x86_64/7/epel/packages/python2-httplib2-0.18.1-3.el7.noarch.rpm: Header V4 RSA/SHA256 Signature, key ID 352c64e5: NOKEY            ] 1.1 MB/s | 5.9 MB  00:00:12 ETA 
python2-httplib2-0.18.1-3.el7.noarch.rpm 的公钥尚未安装
(12/17): python2-httplib2-0.18.1-3.el7.noarch.rpm                                                                                                                     | 125 kB  00:00:00     
(13/17): python2-jmespath-0.9.4-2.el7.noarch.rpm                                                                                                                      |  41 kB  00:00:00     
(14/17): sshpass-1.06-2.el7.x86_64.rpm                                                                                                                                |  21 kB  00:00:00     
(15/17): python2-pyasn1-0.1.9-7.el7.noarch.rpm                                                                                                                        | 100 kB  00:00:03     
(16/17): python2-cryptography-1.7.2-2.el7.x86_64.rpm                                                                                                                  | 502 kB  00:00:11     
(17/17): ansible-2.9.27-1.el7.noarch.rpm                                                                                                                              |  17 MB  00:00:23     
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
总计                                                                                                                                                         895 kB/s |  21 MB  00:00:23     
从 http://mirrors.cloud.tencent.com/epel/RPM-GPG-KEY-EPEL-7 检索密钥
导入 GPG key 0x352C64E5:
 用户ID     : "Fedora EPEL (7) <epel@fedoraproject.org>"
 指纹       : 91e9 7d7c 4a5e 96f1 7f3e 888f 6a2f aea2 352c 64e5
 来自       : http://mirrors.cloud.tencent.com/epel/RPM-GPG-KEY-EPEL-7
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  正在安装    : python2-pyasn1-0.1.9-7.el7.noarch                                                                                                                                       1/17 
  正在安装    : python-markupsafe-0.11-10.el7.x86_64                                                                                                                                    2/17 
  正在安装    : sshpass-1.06-2.el7.x86_64                                                                                                                                               3/17 
  正在安装    : python2-httplib2-0.18.1-3.el7.noarch                                                                                                                                    4/17 
  正在安装    : python-babel-0.9.6-8.el7.noarch                                                                                                                                         5/17 
  正在安装    : python-jinja2-2.7.2-4.el7.noarch                                                                                                                                        6/17 
  正在安装    : python2-jmespath-0.9.4-2.el7.noarch                                                                                                                                     7/17 
  正在安装    : python-enum34-1.0.4-1.el7.noarch                                                                                                                                        8/17 
  正在安装    : python-ply-3.4-11.el7.noarch                                                                                                                                            9/17 
  正在安装    : python-pycparser-2.14-1.el7.noarch                                                                                                                                     10/17 
  正在安装    : python-cffi-1.6.0-5.el7.x86_64                                                                                                                                         11/17 
  正在安装    : libyaml-0.1.4-11.el7_0.x86_64                                                                                                                                          12/17 
  正在安装    : PyYAML-3.10-11.el7.x86_64                                                                                                                                              13/17 
  正在安装    : python-idna-2.4-1.el7.noarch                                                                                                                                           14/17 
  正在安装    : python2-cryptography-1.7.2-2.el7.x86_64                                                                                                                                15/17 
  正在安装    : python-paramiko-2.1.1-9.el7.noarch                                                                                                                                     16/17 
  正在安装    : ansible-2.9.27-1.el7.noarch                                                                                                                                            17/17 
  验证中      : python-idna-2.4-1.el7.noarch                                                                                                                                            1/17 
  验证中      : libyaml-0.1.4-11.el7_0.x86_64                                                                                                                                           2/17 
  验证中      : python-ply-3.4-11.el7.noarch                                                                                                                                            3/17 
  验证中      : python-enum34-1.0.4-1.el7.noarch                                                                                                                                        4/17 
  验证中      : ansible-2.9.27-1.el7.noarch                                                                                                                                             5/17 
  验证中      : python-paramiko-2.1.1-9.el7.noarch                                                                                                                                      6/17 
  验证中      : python2-jmespath-0.9.4-2.el7.noarch                                                                                                                                     7/17 
  验证中      : python-babel-0.9.6-8.el7.noarch                                                                                                                                         8/17 
  验证中      : python2-httplib2-0.18.1-3.el7.noarch                                                                                                                                    9/17 
  验证中      : python-cffi-1.6.0-5.el7.x86_64                                                                                                                                         10/17 
  验证中      : sshpass-1.06-2.el7.x86_64                                                                                                                                              11/17 
  验证中      : python-jinja2-2.7.2-4.el7.noarch                                                                                                                                       12/17 
  验证中      : python2-pyasn1-0.1.9-7.el7.noarch                                                                                                                                      13/17 
  验证中      : PyYAML-3.10-11.el7.x86_64                                                                                                                                              14/17 
  验证中      : python-pycparser-2.14-1.el7.noarch                                                                                                                                     15/17 
  验证中      : python-markupsafe-0.11-10.el7.x86_64                                                                                                                                   16/17 
  验证中      : python2-cryptography-1.7.2-2.el7.x86_64                                                                                                                                17/17 

已安装:
  ansible.noarch 0:2.9.27-1.el7                                                                                                                                                              

作为依赖被安装:
  PyYAML.x86_64 0:3.10-11.el7                    libyaml.x86_64 0:0.1.4-11.el7_0               python-babel.noarch 0:0.9.6-8.el7            python-cffi.x86_64 0:1.6.0-5.el7                 
  python-enum34.noarch 0:1.0.4-1.el7             python-idna.noarch 0:2.4-1.el7                python-jinja2.noarch 0:2.7.2-4.el7           python-markupsafe.x86_64 0:0.11-10.el7           
  python-paramiko.noarch 0:2.1.1-9.el7           python-ply.noarch 0:3.4-11.el7                python-pycparser.noarch 0:2.14-1.el7         python2-cryptography.x86_64 0:1.7.2-2.el7        
  python2-httplib2.noarch 0:0.18.1-3.el7         python2-jmespath.noarch 0:0.9.4-2.el7         python2-pyasn1.noarch 0:0.1.9-7.el7          sshpass.x86_64 0:1.06-2.el7                      

完毕！
[root@bogon qianfeng]# ansible --version
ansible 2.9.27
  config file = /etc/ansible/ansible.cfg
  configured module search path = [u'/root/.ansible/plugins/modules', u'/usr/share/ansible/plugins/modules']
  ansible python module location = /usr/lib/python2.7/site-packages/ansible
  executable location = /usr/bin/ansible
  python version = 2.7.5 (default, Aug  4 2017, 00:39:18) [GCC 4.8.5 20150623 (Red Hat 4.8.5-16)]
[root@bogon qianfeng]# ping 192.168.72.130
PING 192.168.72.130 (192.168.72.130) 56(84) bytes of data.
64 bytes from 192.168.72.130: icmp_seq=1 ttl=64 time=0.637 ms
64 bytes from 192.168.72.130: icmp_seq=2 ttl=64 time=0.870 ms
64 bytes from 192.168.72.130: icmp_seq=3 ttl=64 time=0.870 ms
64 bytes from 192.168.72.130: icmp_seq=4 ttl=64 time=1.15 ms
64 bytes from 192.168.72.130: icmp_seq=5 ttl=64 time=0.876 ms
^C
--- 192.168.72.130 ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4004ms
rtt min/avg/max/mdev = 0.637/0.880/1.150/0.165 ms
[root@bogon qianfeng]# useradd jess
[root@bogon qianfeng]# passwd jess
更改用户 jess 的密码 。
新的 密码：
无效的密码： 密码少于 8 个字符
重新输入新的 密码：
passwd：所有的身份验证令牌已经成功更新。
[root@bogon qianfeng]# ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): 
Created directory '/root/.ssh'.
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:kxrrRWPBPfaqbonJrefv1XLIc+YPwD+h5ez5Ka1fuNg root@bogon
The key's randomart image is:
+---[RSA 2048]----+
|                 |
|       . .       |
|        o +      |
|         + +     |
|      . S   + o  |
|       * o o X o |
|     .o+... B & .|
|     .+.=. . % *o|
|      o*+oo ..E=o|
+----[SHA256]-----+
[root@bogon qianfeng]# ssh-copy-id -i /home/jess/.
./             .bash_logout   .bashrc        
../            .bash_profile  .mozilla/      
[root@bogon qianfeng]# su - jess
[jess@bogon ~]$ ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/home/jess/.ssh/id_rsa): 
Created directory '/home/jess/.ssh'.
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /home/jess/.ssh/id_rsa.
Your public key has been saved in /home/jess/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:MigVKgegjcM/gsiRXgqpFFFNAzbP+ZLU3ofloNf+t9k jess@bogon
The key's randomart image is:
+---[RSA 2048]----+
|+oo==o           |
|o=+.+o+          |
|B=+..= . . .     |
|O+=...+ o *      |
|+=.o.oo+S+ +     |
|  ... .o. o      |
|           .     |
|            .  .o|
|             ..oE|
+----[SHA256]-----+
[jess@bogon ~]$ ssh-copy-id /home/jess/.ssh/id_rsa.pub jess@192.168.72.130
/bin/ssh-copy-id: ERROR: Too many arguments.  Expecting a target hostname, got: '/home/jess/.ssh/id_rsa.pub' 'jess@192.168.72.130'

Usage: /bin/ssh-copy-id [-h|-?|-f|-n] [-i [identity_file]] [-p port] [[-o <ssh -o options>] ...] [user@]hostname
	-f: force mode -- copy keys without trying to check if they are already installed
	-n: dry run    -- no keys are actually copied
	-h|-?: print this help
[jess@bogon ~]$ ssh jess@192.168.72.130
The authenticity of host '192.168.72.130 (192.168.72.130)' can't be established.
ECDSA key fingerprint is SHA256:jLEBIr2vbp2q0OChP8oGXgY33I8PgY9hqYjUGbPuiEg.
ECDSA key fingerprint is MD5:1e:0c:6e:12:67:b2:9c:cc:82:92:d0:02:5f:41:8a:02.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '192.168.72.130' (ECDSA) to the list of known hosts.
jess@192.168.72.130's password: 
[jess@bogon ~]$ eit
bash: eit: 未找到命令...
[jess@bogon ~]$ exit
登出
Connection to 192.168.72.130 closed.
[jess@bogon ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN qlen 1
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000
    link/ether 00:0c:29:f5:2f:23 brd ff:ff:ff:ff:ff:ff
    inet 192.168.72.128/24 brd 192.168.72.255 scope global dynamic ens33
       valid_lft 1136sec preferred_lft 1136sec
    inet6 fe80::a8c3:4ad0:8f12:c71e/64 scope link 
       valid_lft forever preferred_lft forever
3: virbr0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN qlen 1000
    link/ether 52:54:00:6e:49:8c brd ff:ff:ff:ff:ff:ff
    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0
       valid_lft forever preferred_lft forever
4: virbr0-nic: <BROADCAST,MULTICAST> mtu 1500 qdisc pfifo_fast master virbr0 state DOWN qlen 1000
    link/ether 52:54:00:6e:49:8c brd ff:ff:ff:ff:ff:ff
[jess@bogon ~]$ ssh-copy-id -i  /home/jess/.ssh/id_rsa.pub jess@192.168.72.130
/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/home/jess/.ssh/id_rsa.pub"
/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
jess@192.168.72.130's password: 

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'jess@192.168.72.130'"
and check to make sure that only the key(s) you wanted were added.

[jess@bogon ~]$ ssh jess@192.168.72.130
Last login: Mon Oct 27 11:23:29 2025 from 192.168.72.128
[jess@bogon ~]$ 



[root@localhost ~]# vim   /etc/sudoers.d/jess
[root@localhost ~]# scp   /etc/sudoers.d/jess     root@192.168.72.130:/etc/sudoers.d/
The authenticity of host '192.168.72.130 (192.168.72.130)' can't be established.
ECDSA key fingerprint is SHA256:jLEBIr2vbp2q0OChP8oGXgY33I8PgY9hqYjUGbPuiEg.
ECDSA key fingerprint is MD5:1e:0c:6e:12:67:b2:9c:cc:82:92:d0:02:5f:41:8a:02.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '192.168.72.130' (ECDSA) to the list of known hosts.
root@192.168.72.130's password: 
Permission denied, please try again.
root@192.168.72.130's password: 
jess                                          100%   28    28.4KB/s   00:00    
[root@localhost ~]# ssh jess@192.168.72.130
jess@192.168.72.130's password: 
Permission denied, please try again.
jess@192.168.72.130's password: 
Last login: Mon Oct 27 11:25:09 2025 from 192.168.72.128
[jess@bogon ~]$ ssh-copy-id -i  /home/jess/.ssh/id_rsa.pub jess@192.168.72.130

/usr/bin/ssh-copy-id: ERROR: failed to open ID file '/home/jess/.ssh/id_rsa.pub': 没有那个文件或目录
[jess@bogon ~]$ exit
登出
Connection to 192.168.72.130 closed.
[root@localhost ~]# ssh-copy-id -i  /home/jess/.ssh/id_rsa.pub jess@192.168.72.130
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/home/jess/.ssh/id_rsa.pub"
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed

/usr/bin/ssh-copy-id: WARNING: All keys were skipped because they already exist on the remote system.
		(if you think this is a mistake, you may want to use -f option)

[root@localhost ~]#  ssh jess@192.168.72.130
jess@192.168.72.130's password: 
Last login: Mon Oct 27 11:42:01 2025 from 192.168.72.128
[jess@bogon ~]$ exit
登出
Connection to 192.168.72.130 closed.
[root@localhost ~]# su - jess
上一次登录：一 10月 27 11:21:18 CST 2025pts/0 上
[jess@bogon ~]$ ssh jess@192.168.72.130
Last login: Mon Oct 27 11:44:09 2025 from 192.168.72.128
[jess@bogon ~]$ packet_write_wait: Connection to 192.168.72.130 port 22: Broken pipe
[jess@bogon ~]$ 
[jess@bogon ~]$ exit
登出
[root@localhost ~]# su jess
[jess@localhost root]$ vim /etc/ansible/hosts
[jess@localhost root]$ sudo vim /etc/ansible/hosts
[jess@localhost root]$ ansible opengroup --list-hosts
  hosts (1):
    192.168.72.130
[jess@localhost root]$ ll
ls: 无法打开目录.: 权限不够
[jess@localhost root]$ sudo ll
sudo: ll：找不到命令
[jess@localhost root]$ sudo ls
anaconda-ks.cfg			  initial-setup-ks.cfg	模板  图片  下载  桌面
CentOS-7-x86_64-Minimal-2009.iso  公共			视频  文档  音乐
[jess@localhost root]$ ansible qf --list-host
  hosts (1):
    192.168.72.130
[jess@localhost root]$ ping 192.168.72.130
connect: 网络不可达
[jess@localhost root]$ ping 192.168.72.130
connect: 网络不可达
[jess@localhost root]$ sudo ping 192.168.72.130
connect: 网络不可达
[jess@localhost root]$ sudo ping 192.168.72.2
connect: 网络不可达
[jess@localhost root]$ sudo ping 192.168.72.1
connect: 网络不可达
[jess@localhost root]$ sudo ping 192.168.72.1
PING 192.168.72.1 (192.168.72.1) 56(84) bytes of data.
^C
--- 192.168.72.1 ping statistics ---
7 packets transmitted, 0 received, 100% packet loss, time 6005ms

[jess@localhost root]$ sudo ping 192.168.72.130
PING 192.168.72.130 (192.168.72.130) 56(84) bytes of data.
64 bytes from 192.168.72.130: icmp_seq=1 ttl=64 time=0.711 ms
64 bytes from 192.168.72.130: icmp_seq=2 ttl=64 time=0.850 ms
64 bytes from 192.168.72.130: icmp_seq=3 ttl=64 time=1.06 ms
64 bytes from 192.168.72.130: icmp_seq=4 ttl=64 time=0.971 ms
64 bytes from 192.168.72.130: icmp_seq=5 ttl=64 time=0.851 ms
64 bytes from 192.168.72.130: icmp_seq=6 ttl=64 time=0.849 ms
^C
--- 192.168.72.130 ping statistics ---
6 packets transmitted, 6 received, 0% packet loss, time 5006ms
rtt min/avg/max/mdev = 0.711/0.882/1.063/0.114 ms
[jess@localhost root]$ ansible qf --list-host
  hosts (1):
    192.168.72.130
[jess@localhost root]$ cd /home
[jess@localhost home]$ ll
总用量 4
drwx------.  7 jess     jess      172 10月 27 14:35 jess
drwx------. 15 qianfeng qianfeng 4096 10月 27 11:31 qianfeng
[jess@localhost home]$ cd jess
[jess@localhost ~]$ ll
总用量 0
[jess@localhost ~]$ mkdir -p  project
[jess@localhost ~]$ ll
总用量 0
drwxrwxr-x. 2 jess jess 6 10月 27 15:01 project
[jess@localhost ~]$ cd project
[jess@localhost project]$ ll
总用量 0
[jess@localhost project]$ pwd
/home/jess/project
[jess@localhost project]$ sudo vim /etc/ansible/hosts
[jess@localhost project]$ vim inventory
[jess@localhost project]$ ll
总用量 4
-rw-rw-r--. 1 jess jess 47 10月 27 15:05 inventory
[jess@localhost project]$ ansible qf1 --list-hosts
[WARNING]: Could not match supplied host pattern, ignoring: qf1
[WARNING]: No hosts matched, nothing to do
  hosts (0):
[jess@localhost project]$ ansible qf1 --list-hosts --inventory inventory
  hosts (1):
    192.168.72.130
[jess@localhost project]$ ansible qf1 --list-hosts --i inventory
usage: ansible [-h] [--version] [-v] [-b] [--become-method BECOME_METHOD]
               [--become-user BECOME_USER] [-K] [-i INVENTORY] [--list-hosts]
               [-l SUBSET] [-P POLL_INTERVAL] [-B SECONDS] [-o] [-t TREE] [-k]
               [--private-key PRIVATE_KEY_FILE] [-u REMOTE_USER]
               [-c CONNECTION] [-T TIMEOUT]
               [--ssh-common-args SSH_COMMON_ARGS]
               [--sftp-extra-args SFTP_EXTRA_ARGS]
               [--scp-extra-args SCP_EXTRA_ARGS]
               [--ssh-extra-args SSH_EXTRA_ARGS] [-C] [--syntax-check] [-D]
               [-e EXTRA_VARS] [--vault-id VAULT_IDS]
               [--ask-vault-pass | --vault-password-file VAULT_PASSWORD_FILES]
               [-f FORKS] [-M MODULE_PATH] [--playbook-dir BASEDIR]
               [-a MODULE_ARGS] [-m MODULE_NAME]
               pattern
ansible: error: ambiguous option: --i could match --inventory-file, --inventory
[jess@localhost project]$ ansible qf1 --list-hosts -i inventory
  hosts (1):
    192.168.72.130






-------
192.168.72.132 node1
192.168.72.133 node2

```

```shell
Xshell 5 (Build 0964)
Copyright (c) 2002-2016 NetSarang Computer, Inc. All rights reserved.

Type `help' to learn how to use Xshell prompt.
[d:\~]$ 

Connecting to 192.168.72.131:22...
Connection established.
To escape to local shell, press 'Ctrl+Alt+]'.

Last login: Mon Oct 27 04:39:18 2025
[root@bogon ~]# 
[root@bogon ~]# 
[root@bogon ~]# passwd jess
Changing password for user jess.
New password: 
BAD PASSWORD: The password is shorter than 8 characters
Retype new password: 
passwd: all authentication tokens updated successfully.
[root@bogon ~]# su -jess
su: invalid option -- 'j'

Usage:
 su [options] [-] [USER [arg]...]

Change the effective user id and group id to that of USER.
A mere - implies -l.   If USER not given, assume root.

Options:
 -m, -p, --preserve-environment  do not reset environment variables
 -g, --group <group>             specify the primary group
 -G, --supp-group <group>        specify a supplemental group

 -, -l, --login                  make the shell a login shell
 -c, --command <command>         pass a single command to the shell with -c
 --session-command <command>     pass a single command to the shell with -c
                                 and do not create a new session
 -f, --fast                      pass -f to the shell (for csh or tcsh)
 -s, --shell <shell>             run shell if /etc/shells allows it

 -h, --help     display this help and exit
 -V, --version  output version information and exit

For more details see su(1).
[root@bogon ~]# su --jess
su: unrecognized option '--jess'

Usage:
 su [options] [-] [USER [arg]...]

Change the effective user id and group id to that of USER.
A mere - implies -l.   If USER not given, assume root.

Options:
 -m, -p, --preserve-environment  do not reset environment variables
 -g, --group <group>             specify the primary group
 -G, --supp-group <group>        specify a supplemental group

 -, -l, --login                  make the shell a login shell
 -c, --command <command>         pass a single command to the shell with -c
 --session-command <command>     pass a single command to the shell with -c
                                 and do not create a new session
 -f, --fast                      pass -f to the shell (for csh or tcsh)
 -s, --shell <shell>             run shell if /etc/shells allows it

 -h, --help     display this help and exit
 -V, --version  output version information and exit

For more details see su(1).
[root@bogon ~]# su -jess
su: invalid option -- 'j'

Usage:
 su [options] [-] [USER [arg]...]

Change the effective user id and group id to that of USER.
A mere - implies -l.   If USER not given, assume root.

Options:
 -m, -p, --preserve-environment  do not reset environment variables
 -g, --group <group>             specify the primary group
 -G, --supp-group <group>        specify a supplemental group

 -, -l, --login                  make the shell a login shell
 -c, --command <command>         pass a single command to the shell with -c
 --session-command <command>     pass a single command to the shell with -c
                                 and do not create a new session
 -f, --fast                      pass -f to the shell (for csh or tcsh)
 -s, --shell <shell>             run shell if /etc/shells allows it

 -h, --help     display this help and exit
 -V, --version  output version information and exit

For more details see su(1).
[root@bogon ~]# su - jess
[jess@bogon ~]$ ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/home/jess/.ssh/id_rsa): 
Created directory '/home/jess/.ssh'.
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /home/jess/.ssh/id_rsa.
Your public key has been saved in /home/jess/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:1Xm8cSoSazt/dVbjFInrPPdtuDUjYpowglbtj5g8vBE jess@bogon
The key's randomart image is:
+---[RSA 2048]----+
|              . .|
|           . + o |
|          o o = o|
|      .  . o o B.|
|     E .S + + = o|
|    o o  . o = o+|
|   o.o +  oo .o*=|
|  . .o= = +o. +.*|
|     =o. +  ...o |
+----[SHA256]-----+
[jess@bogon ~]$ sudo vi /etc/hosts

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

[sudo] password for jess: 
jess is not in the sudoers file.  This incident will be reported.
[jess@bogon ~]$ exit
logout
You have mail in /var/spool/mail/root
[root@bogon ~]# sudo vi /etc/hosts
[root@bogon ~]# su - jess
Last login: Mon Oct 27 08:53:54 EDT 2025 on pts/0
[jess@bogon ~]$ ping node1
PING node1 (192.168.72.132) 56(84) bytes of data.
64 bytes from node1 (192.168.72.132): icmp_seq=1 ttl=64 time=1.20 ms
64 bytes from node1 (192.168.72.132): icmp_seq=2 ttl=64 time=0.816 ms
64 bytes from node1 (192.168.72.132): icmp_seq=3 ttl=64 time=0.764 ms
64 bytes from node1 (192.168.72.132): icmp_seq=4 ttl=64 time=0.822 ms
^C
--- node1 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3010ms
rtt min/avg/max/mdev = 0.764/0.901/1.202/0.175 ms
[jess@bogon ~]$ ping node2
PING node2 (192.168.72.133) 56(84) bytes of data.
64 bytes from node2 (192.168.72.133): icmp_seq=1 ttl=64 time=1.14 ms
64 bytes from node2 (192.168.72.133): icmp_seq=2 ttl=64 time=0.945 ms
64 bytes from node2 (192.168.72.133): icmp_seq=3 ttl=64 time=0.943 ms
64 bytes from node2 (192.168.72.133): icmp_seq=4 ttl=64 time=0.845 ms
64 bytes from node2 (192.168.72.133): icmp_seq=5 ttl=64 time=0.855 ms
^C
--- node2 ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4042ms
rtt min/avg/max/mdev = 0.845/0.946/1.146/0.114 ms
[jess@bogon ~]$ ssh-copy-id-i /home/jess/.ssh/id_rsa.pub jess@node1
-bash: ssh-copy-id-i: command not found
[jess@bogon ~]$ ssh-copy-id -i /home/jess/.ssh/id_rsa.pub jess@node1
/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/home/jess/.ssh/id_rsa.pub"
The authenticity of host 'node1 (192.168.72.132)' can't be established.
ECDSA key fingerprint is SHA256:4Mrsd1SuBlcerITMcoX0YBPtudm4m1OfarRyjx7dNns.
ECDSA key fingerprint is MD5:7a:d9:c9:82:14:d1:d3:21:32:a1:01:b1:75:9b:f8:87.
Are you sure you want to continue connecting (yes/no)? yes
/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
jess@node1's password: 

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'jess@node1'"
and check to make sure that only the key(s) you wanted were added.

[jess@bogon ~]$ ssh jess@node1
Last login: Mon Oct 27 08:53:04 2025
[jess@bogon ~]$ ifconfig
ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.72.132  netmask 255.255.255.0  broadcast 192.168.72.255
        inet6 fe80::4b74:69c3:799e:b14b  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:8f:f0:ff  txqueuelen 1000  (Ethernet)
        RX packets 2113  bytes 178479 (174.2 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 749  bytes 81858 (79.9 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1  (Local Loopback)
        RX packets 2  bytes 98 (98.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 2  bytes 98 (98.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

[jess@bogon ~]$ exit
logout
Connection to node1 closed.
[jess@bogon ~]$ ssh-copy-id -i /home/jess/.ssh/id_rsa.pub jess@node2
/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/home/jess/.ssh/id_rsa.pub"
The authenticity of host 'node2 (192.168.72.133)' can't be established.
ECDSA key fingerprint is SHA256:4Mrsd1SuBlcerITMcoX0YBPtudm4m1OfarRyjx7dNns.
ECDSA key fingerprint is MD5:7a:d9:c9:82:14:d1:d3:21:32:a1:01:b1:75:9b:f8:87.
Are you sure you want to continue connecting (yes/no)? yes
/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
jess@node2's password: 

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'jess@node2'"
and check to make sure that only the key(s) you wanted were added.

[jess@bogon ~]$ ssh jess@node2
Last login: Mon Oct 27 08:53:44 2025
[jess@bogon ~]$ vim   /etc/sudoers.d/jess
-bash: vim: command not found
[jess@bogon ~]$ vi   /etc/sudoers.d/jess
[jess@bogon ~]$ sudo vi   /etc/sudoers.d/jess

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

[sudo] password for jess: 
jess is not in the sudoers file.  This incident will be reported.
[jess@bogon ~]$ sudo vi   /etc/sudoers.d/jess
[sudo] password for jess: 
jess is not in the sudoers file.  This incident will be reported.
[jess@bogon ~]$ exit
logout
Connection to node2 closed.
[jess@bogon ~]$ sudo vi   /etc/sudoers.d/jess
[sudo] password for jess: 
jess is not in the sudoers file.  This incident will be reported.
[jess@bogon ~]$ exit
logout
You have new mail in /var/spool/mail/root
[root@bogon ~]# vim   /etc/sudoers.d/jess
-bash: vim: command not found
[root@bogon ~]# vi   /etc/sudoers.d/jess
[root@bogon ~]# scp   /etc/sudoers.d/jess     root@node1:/etc/sudoers.d/
The authenticity of host 'node1 (192.168.72.132)' can't be established.
ECDSA key fingerprint is SHA256:4Mrsd1SuBlcerITMcoX0YBPtudm4m1OfarRyjx7dNns.
ECDSA key fingerprint is MD5:7a:d9:c9:82:14:d1:d3:21:32:a1:01:b1:75:9b:f8:87.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added 'node1,192.168.72.132' (ECDSA) to the list of known hosts.
root@node1's password: 
jess                                                         100%   28    23.7KB/s   00:00    
[root@bogon ~]# scp   /etc/sudoers.d/jess     root@node2:/etc/sudoers.d/
The authenticity of host 'node2 (192.168.72.133)' can't be established.
ECDSA key fingerprint is SHA256:4Mrsd1SuBlcerITMcoX0YBPtudm4m1OfarRyjx7dNns.
ECDSA key fingerprint is MD5:7a:d9:c9:82:14:d1:d3:21:32:a1:01:b1:75:9b:f8:87.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added 'node2,192.168.72.133' (ECDSA) to the list of known hosts.
root@node2's password: 
jess                                                         100%   28    19.8KB/s   00:00    
[root@bogon ~]# su jess
[jess@bogon root]$ sudo vi /etc/ansible/hosts
[jess@bogon root]$ ansible opengroup --list-hosts
[WARNING]: Could not match supplied host pattern, ignoring: opengroup
[WARNING]: No hosts matched, nothing to do
  hosts (0):
[jess@bogon root]$ ansible nodegroup --list-hosts
  hosts (2):
    node1
    node2
[jess@bogon root]$ sudo vi /etc/ansible/hosts
[jess@bogon root]$ mkdir -p  project
mkdir: cannot create directory ‘project’: Permission denied
[jess@bogon root]$ cd /home
[jess@bogon home]$ cd jess
[jess@bogon ~]$ mkdir -p  project
[jess@bogon ~]$ ll
total 0
drwxrwxr-x. 2 jess jess 6 Oct 27 10:37 project
[jess@bogon ~]$ sudo vi /etc/ansible/hosts
[jess@bogon ~]$ vi inventory
[jess@bogon ~]$ ansible opengroup --list-hosts
[WARNING]: Could not match supplied host pattern, ignoring: opengroup
[WARNING]: No hosts matched, nothing to do
  hosts (0):
[jess@bogon ~]$ ansible nodegroup --list-hosts
  hosts (1):
    node1
[jess@bogon ~]$ ansible nodegroup --list-hosts --inventory inventory
[WARNING]:  * Failed to parse /home/jess/inventory with yaml plugin: We were unable to read
either as JSON nor YAML, these are the errors we got from each: JSON: No JSON object could be
decoded  Syntax Error while loading YAML.   did not find expected <document start>  The error
appears to be in '/home/jess/inventory': line 2, column 1, but may be elsewhere in the file
depending on the exact syntax problem.  The offending line appears to be:  [qf2] node2 ^ here
[WARNING]:  * Failed to parse /home/jess/inventory with ini plugin: /home/jess/inventory:5:
Section [nodegroup:children] includes undefined group: node2
[WARNING]: Unable to parse /home/jess/inventory as an inventory source
[WARNING]: No inventory was parsed, only implicit localhost is available
[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit
localhost does not match 'all'
  hosts (0):
[jess@bogon ~]$ vi inventory
[jess@bogon ~]$ ansible nodegroup --list-hosts --inventory inventory
  hosts (1):
    node2
[jess@bogon ~]$ ansible nodegroup --list-hosts --i inventory
usage: ansible [-h] [--version] [-v] [-b] [--become-method BECOME_METHOD]
               [--become-user BECOME_USER] [-K] [-i INVENTORY] [--list-hosts]
               [-l SUBSET] [-P POLL_INTERVAL] [-B SECONDS] [-o] [-t TREE] [-k]
               [--private-key PRIVATE_KEY_FILE] [-u REMOTE_USER]
               [-c CONNECTION] [-T TIMEOUT]
               [--ssh-common-args SSH_COMMON_ARGS]
               [--sftp-extra-args SFTP_EXTRA_ARGS]
               [--scp-extra-args SCP_EXTRA_ARGS]
               [--ssh-extra-args SSH_EXTRA_ARGS] [-C] [--syntax-check] [-D]
               [-e EXTRA_VARS] [--vault-id VAULT_IDS]
               [--ask-vault-pass | --vault-password-file VAULT_PASSWORD_FILES]
               [-f FORKS] [-M MODULE_PATH] [--playbook-dir BASEDIR]
               [-a MODULE_ARGS] [-m MODULE_NAME]
               pattern
ansible: error: ambiguous option: --i could match --inventory-file, --inventory
[jess@bogon ~]$ ansible nodegroup --list-hosts -i inventory
  hosts (1):
    node2
[jess@bogon ~]$ 





[privilege_escalation]
become=True
become_method=sudo
become_user=root
become_ask_pass=False

```


```shell
[qianfeng@bogon ~]$ su - root
密码：
上一次登录：一 10月 27 09:48:05 CST 2025:0 上
[root@bogon ~]# useradd jess
[root@bogon ~]# passwd jess 
更改用户 jess 的密码 。
新的 密码：
无效的密码： 密码少于 8 个字符
重新输入新的 密码：
passwd：所有的身份验证令牌已经成功更新。
[root@bogon ~]# ip 
Usage: ip [ OPTIONS ] OBJECT { COMMAND | help }
       ip [ -force ] -batch filename
where  OBJECT := { link | address | addrlabel | route | rule | neigh | ntable |
                   tunnel | tuntap | maddress | mroute | mrule | monitor | xfrm |
                   netns | l2tp | macsec | tcp_metrics | token }
       OPTIONS := { -V[ersion] | -s[tatistics] | -d[etails] | -r[esolve] |
                    -h[uman-readable] | -iec |
                    -f[amily] { inet | inet6 | ipx | dnet | bridge | link } |
                    -4 | -6 | -I | -D | -B | -0 |
                    -l[oops] { maximum-addr-flush-attempts } |
                    -o[neline] | -t[imestamp] | -ts[hort] | -b[atch] [filename] |
                    -rc[vbuf] [size] | -n[etns] name | -a[ll] }
[root@bogon ~]# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN qlen 1
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000
    link/ether 00:0c:29:36:f1:6b brd ff:ff:ff:ff:ff:ff
    inet 192.168.72.130/24 brd 192.168.72.255 scope global dynamic ens33
       valid_lft 1618sec preferred_lft 1618sec
    inet6 fe80::74bd:6b05:c195:28c9/64 scope link 
       valid_lft forever preferred_lft forever
    inet6 fe80::a8c3:4ad0:8f12:c71e/64 scope link tentative dadfailed 
       valid_lft forever preferred_lft forever
3: virbr0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN qlen 1000
    link/ether 52:54:00:6e:49:8c brd ff:ff:ff:ff:ff:ff
    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0
       valid_lft forever preferred_lft forever
4: virbr0-nic: <BROADCAST,MULTICAST> mtu 1500 qdisc pfifo_fast master virbr0 state DOWN qlen 1000
    link/ether 52:54:00:6e:49:8c brd ff:ff:ff:ff:ff:ff
[root@bogon ~]# 


[qianfeng@bogon ~]$ cd /etc/sudoers.d
bash: cd: /etc/sudoers.d: 权限不够
[qianfeng@bogon ~]$ su
密码：
[root@bogon qianfeng]# cd /etc/sudoers.d
[root@bogon sudoers.d]# ll
总用量 4
-rw-r--r--. 1 root root 28 10月 27 11:38 jess
[root@bogon sudoers.d]# exit
exit
[qianfeng@bogon ~]$  su jess
密码：
[jess@bogon qianfeng]$ sudo useradd uutest1
[jess@bogon qianfeng]$ ifconfig
ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.72.130  netmask 255.255.255.0  broadcast 192.168.72.255
        inet6 fe80::74bd:6b05:c195:28c9  prefixlen 64  scopeid 0x20<link>
        inet6 fe80::a8c3:4ad0:8f12:c71e  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:36:f1:6b  txqueuelen 1000  (Ethernet)
        RX packets 2431  bytes 185342 (180.9 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 514  bytes 62658 (61.1 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1  (Local Loopback)
        RX packets 273  bytes 23632 (23.0 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 273  bytes 23632 (23.0 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

virbr0: flags=4099<UP,BROADCAST,MULTICAST>  mtu 1500
        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255
        ether 52:54:00:6e:49:8c  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

[jess@bogon qianfeng]$ 

```